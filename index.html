<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>ØªÙ‚ÙˆÙŠÙ… Ø£Ù… Ø§Ù„Ù‚Ø±Ù‰ Ø¨Ø§Ù„Ø£Ø­Ø¯Ø§Ø«</title>

<style>
*{box-sizing:border-box;font-family:Tahoma}
body{margin:0;background:#f3f4f6}
.page{max-width:1400px;margin:20px auto;background:#fff;padding:20px;border-radius:12px}
button{cursor:pointer}
.status-admin{background:#dcfce7;color:#166534;padding:6px 12px;border-radius:20px}
.status-visitor{background:#fee2e2;color:#991b1b;padding:6px 12px;border-radius:20px}
.controls button{margin:4px}
.hidden{display:none!important}
.today{outline:2px solid #16a34a;background:#ecfdf5}
</style>
</head>

<body>

<div class="page">
  <h2 style="text-align:center">ØªÙ‚ÙˆÙŠÙ… Ø£Ù… Ø§Ù„Ù‚Ø±Ù‰ (Ù‡Ø¬Ø±ÙŠ)</h2>

  <div style="display:flex;justify-content:space-between;align-items:center">
    <div id="adminStatus" class="status-visitor">ÙˆØ¶Ø¹ Ø§Ù„Ø²Ø§Ø¦Ø±</div>
    <div class="controls">
      <button id="adminToggleBtn" onclick="toggleAdmin()">ğŸ” Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø¯ÙŠØ±</button>
      <button onclick="scrollToToday()">ğŸ“ Ø§Ù„ÙŠÙˆÙ…</button>
      <button onclick="window.print()">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø©</button>
      <button id="backupBtn" class="hidden" onclick="downloadBackup()">ğŸ”„ Ù†Ø³Ø® Ø§Ø­ØªÙŠØ§Ø·ÙŠ</button>
      <button id="restoreBtn" class="hidden" onclick="triggerRestore()">â¬†ï¸ Ø§Ø³ØªØ¹Ø§Ø¯Ø©</button>
    </div>
  </div>

  <hr>

  <div id="calendarContainer"></div>
</div>

<input type="file" id="backupFileInput" accept="application/json" style="display:none">

<script>
/* =================== Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª =================== */
const ADMIN_PASSWORD_KEY = "ADMIN_PWD";
const DEFAULT_PWD = "1234";
let isAdmin = false;
let events = {};

/* =================== ØªØ¹Ø·ÙŠÙ„ Ù„ÙˆØ­Ø© Ø§Ù„Ù…ÙØ§ØªÙŠØ­ =================== */
document.addEventListener("keydown", function(e){
  if (isAdmin) return;

  const forbidden =
    e.key === "F12" ||
    (e.ctrlKey && ["s","p","u","o","c","x","v"].includes(e.key.toLowerCase())) ||
    (e.ctrlKey && e.shiftKey && ["i","j","c"].includes(e.key.toLowerCase()));

  if (forbidden){
    e.preventDefault();
    e.stopPropagation();
  }
});

/* =================== Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø¯ÙŠØ± =================== */
function toggleAdmin(){
  if (isAdmin){
    isAdmin = false;
    updateAdminUI();
    return;
  }
  const pwd = prompt("Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±:");
  if (pwd === (localStorage.getItem(ADMIN_PASSWORD_KEY)||DEFAULT_PWD)){
    isAdmin = true;
    updateAdminUI();
  } else {
    alert("ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©");
  }
}

function updateAdminUI(){
  const badge = document.getElementById("adminStatus");
  const btn = document.getElementById("adminToggleBtn");
  const bkp = document.getElementById("backupBtn");
  const rst = document.getElementById("restoreBtn");

  if (isAdmin){
    badge.textContent = "ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø¯ÙŠØ±";
    badge.className = "status-admin";
    btn.textContent = "ğŸšª Ø®Ø±ÙˆØ¬ Ø§Ù„Ù…Ø¯ÙŠØ±";
    bkp.classList.remove("hidden");
    rst.classList.remove("hidden");
  } else {
    badge.textContent = "ÙˆØ¶Ø¹ Ø§Ù„Ø²Ø§Ø¦Ø±";
    badge.className = "status-visitor";
    btn.textContent = "ğŸ” Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø¯ÙŠØ±";
    bkp.classList.add("hidden");
    rst.classList.add("hidden");
  }
}

/* =================== Ø§Ù„ØªÙ‚ÙˆÙŠÙ… (Ù…Ø«Ø§Ù„ Ù…Ø¨Ø³Ø·) =================== */
function renderCalendar(){
  const c = document.getElementById("calendarContainer");
  c.innerHTML = "";
  const d = document.createElement("div");
  d.textContent = "â† Ù‡Ù†Ø§ Ø§Ù„ØªÙ‚ÙˆÙŠÙ… Ø§Ù„Ù‡Ø¬Ø±ÙŠ (ÙƒÙ…Ø§ ÙÙŠ Ù†Ø³Ø®ØªÙƒ Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©)";
  c.appendChild(d);
}

/* =================== Ù†Ø³Ø® Ø§Ø­ØªÙŠØ§Ø·ÙŠ =================== */
function downloadBackup(){
  if (!isAdmin) return;
  const blob = new Blob([JSON.stringify(events,null,2)],{type:"application/json"});
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "backup.json";
  a.click();
}

function triggerRestore(){
  if (!isAdmin) return;
  document.getElementById("backupFileInput").click();
}

document.getElementById("backupFileInput").addEventListener("change", e=>{
  if (!isAdmin) return;
  const file = e.target.files[0];
  if (!file) return;
  const r = new FileReader();
  r.onload = ev=>{
    events = JSON.parse(ev.target.result);
    alert("ØªÙ…Øª Ø§Ù„Ø§Ø³ØªØ¹Ø§Ø¯Ø©");
  };
  r.readAsText(file);
});

/* =================== Ø§Ù„ÙŠÙˆÙ… =================== */
function scrollToToday(){
  alert("Ø³ÙŠØªÙ… Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„ÙŠÙˆÙ… Ø§Ù„Ø­Ø§Ù„ÙŠ (Ø­Ø³Ø¨ ØªØ·Ø¨ÙŠÙ‚Ùƒ Ø§Ù„ÙƒØ§Ù…Ù„)");
}

/* =================== ØªØ´ØºÙŠÙ„ =================== */
updateAdminUI();
renderCalendar();
</script>

</body>
</html>
